<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <!-- 如何实现订阅者发布模式而努力 -->
    <script>
        // 楼盘  发布者
        // 买房子 订阅者
        const saleOffice = {
            name: 'yiyiyi',
            clientList: {
                // '89s': [],
                // '120s': []
            } // 慢慢加入订阅者
        } //售楼部
        // saleOffice.listen = function(fn) {
        //     this.clientList.push(fn);
        // }
        saleOffice.listen = function(key, fn) {
            if(!this.clientList[key]){ // 没有这个分组
                this.clientList[key] = []//初始化
            }
            this.clientList[key].push(fn)// 订阅的分组能力
        }
        // saleOffice.trigger = function() {
        //     for(let i = 0; i < this.clientList.length; i++){
        //         let client = this.clientList[i];
        //         client.apply(this, arguments)
        //     }
        // }
        saleOffice.trigger = function() {
            const key = Array.prototype.shift.call(arguments);  //key,arguments 数据
            const fns = this.clientList[key]; // 通知的分组？
            if(!fns || fns.length === 0) {// 安全
                return false
            }
            for(let i = 0; i < fns.length; i++){
                let fn = fns[i]
                fn.apply(this, arguments)
            }
        }
        // 关注楼盘 listen 监听
        saleOffice.listen('squareMeter89', function(price, squareMeter){
            console.log(this.name);
            console.log('价格=' + price);
            console.log('squareMeter' + squareMeter);
        })
        saleOffice.listen('squareMeter89', function(price, squareMeter){
            console.log(this.name);
            console.log('价格=' + price);
            console.log('squareMeter' + squareMeter);
        })
        saleOffice.listen('squareMeter142', function(price, squareMeter){
            console.log(this.name);
            console.log('价格=' + price);
            console.log('squareMeter' + squareMeter);
        })
        // saleOffice.trigger('squareMeter142', 12000, 142)
        saleOffice.trigger('squareMeter89', 12000, 89)
        // console.log(saleOffice.clientList);
    </script>
</body>
</html>